
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" , initial-scale=1.0/>
    <script src="https://merchantdemo.sandbox.bka.sh/frontend/resource/js/prism.js"></script>
    <script src="https://merchantdemo.sandbox.bka.sh/frontend/resource/js/jquery.js"></script>
    <!-- JavaScript -->
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/alertify.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                    crossorigin="anonymous"></script>
                    <script src="https://scripts.sandbox.bka.sh/versions/1.1.0-beta/checkout/bKash-checkout-sandbox.js"></script>
    <script src="https://merchantdemo.sandbox.bka.sh/frontend/resource/js/site.common.js"></script>
    <script src="https://merchantdemo.sandbox.bka.sh/frontend/resource/js/site.checkout.js"></script>
    <link rel="stylesheet" href="https://merchantdemo.sandbox.bka.sh/frontend/resource/css/prism.css">
    <link href="https://merchantdemo.sandbox.bka.sh/frontend/resource/css/flatly.bootstrap.4.css" rel="stylesheet"/>
    <link href="https://merchantdemo.sandbox.bka.sh/frontend/resource/css/flatly.custom.css" rel="stylesheet"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/themes/bootstrap.min.css"/>
    <link href="https://merchantdemo.sandbox.bka.sh/frontend/resource/css/checkout.css" rel="stylesheet"/>
</head>

<body class="text-center">

<div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
    <div class="container">
        <a href="https://merchantdemo.sandbox.bka.sh/frontend/checkout" class="navbar-brand">Checkout</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav">
            </ul>

            <ul class="nav navbar-nav ml-auto">
                <li class="nav-item">
                    <span style="color: white;" id="version">1.2.0-beta</span>
                </li>
            </ul>

        </div>
    </div>
</div>

<!---->
<div class="container">


    <div class="bs-docs-section">


        <div class="row">
            <div class="col-lg-12">
                <div class="bs-component">
                    <div class="card mb-12">
                        <div class="card-header">Checkout (<span>1.2.0-beta</span>)
                        </div>
                        <div class="card-body">

                            <div class="bs-docs-section">

                                <div class="row">
                                    <div class="col-lg-7">
                                        <div class="bs-component">
                                            <fieldset>

                                                <div class="form-group">

                                                </div>
                                                <div class="product-details-row">
                                                    <img  src='https://merchantdemo.sandbox.bka.sh/frontend/resource/img/watch.jpg' alt="Watch image" class="item-image-layout">

                                                    <div id="dvpaywithbkash" class="pay-with-bkash-layout">
                                                        <fieldset class="item-details-layout">
                                                            <h5 class="item-name" style="font-weight: bold">Product Name: </h5>
                                                            <h5 class="item-name" style="font-style: italic">Men's Full Guard 2.5 Smartwatch Powered with Wear OS by Google with Heart Rate, GPS, NFC, and Smartphone Notifications</h5>

                                                            <div class="change-amount-layout">
                                                                <label class="col-form-label-amount" for="new_amount" style="font-weight: bold">Amount</label>
                                                                <div id="changeAmountDiv" class="form-group-amount">

                                                                    <input style="color: #061148" type="text" class="form-control" id="new_amount"
                                                                           width="80%"/>
                                                                    <button id="change_amount"
                                                                            class="btn btn-primary btn-sm">
                                                                        Change Amount
                                                                    </button>
                                                                </div>
                                                                <br>
                                                                <div class="item-check-box-layout">
                                                                    <div class="custom-control custom-radio">
                                                                        <input type="radio" name="paymentType" value="immediate"
                                                                               id="immediateRadioBtn" checked class="custom-control-input">
                                                                        <label class="custom-control-label"
                                                                               for="immediateRadioBtn">immediate</label>
                                                                    </div>
                                                                    <div class="custom-control custom-radio" style="margin-left: 8px;">
                                                                        <input type="radio" name="paymentType" value="authNcapture"
                                                                               id="authRadioBtn" class="custom-control-input">
                                                                        <label class="custom-control-label" for="authRadioBtn">auth and
                                                                            capture</label>
                                                                    </div>
                                                                </div>
                                                                <br>
                                                                <div id="dvisaggregrator" class="custom-control custom-switch">
                                                                    <input type="checkbox" class="custom-control-input"
                                                                           name="isAggregator" id="isAggregrator" value="false"
                                                                           unchecked>
                                                                    <label class="custom-control-label" for="isAggregrator">is
                                                                        aggregator?</label>
                                                                </div>

                                                                <div id="dvAggregratorInfo" class="merchant-aggregrate-layout" style="display: none;">
                                                                    <label for="merchantAssociationInfo">Merchant
                                                                        Association Info </label>
                                                                    <input style="color: #061148" type="text" class="form-control-merchant-association-info"
                                                                           onchange="getAggretaroInfo()"
                                                                           placeholder="e.g MI06SWOPNORF08bKashPay"
                                                                           id="merchantAssociationInfo">
                                                                </div>
                                                                <br>
                                                                <div class="button-div">
                                                                    <button id="bKash_button" class="btn btn-primary btn-sm">Pay With bKash
                                                                    </button>
                                                                </div>
                                                            </div>



                                                        </fieldset>
                                                    </div>
                                                </div>

                                            </fieldset>
                                            <div id="dvqueryagreement">
                                                <fieldset class="capture-void-layout">
                                                    <legend class="capture-void-legend-layout">Utility</legend>
                                                <br>
                                                <fieldset class="capture-void-layout">
                                                    <legend class="capture-void-legend-layout">Search Transaction</legend>
                                                <div class="form-group-amount">
                                                    <label class="col-form-label" for="searchTransaction">
                                                        Transaction ID</label>

                                                    <input style="color: #061148" type="text" class="form-control"
                                                           placeholder="Transaction ID"
                                                           id="searchTransaction" width="100px;" />
                                                    <button id="searchTransaction_btn"
                                                            class="btn btn-primary btn-sm">Search Transaction
                                                    </button>
                                                </div>
                                                </fieldset>
                                                <br><br>
                                                <fieldset class="capture-void-layout">
                                                    <legend class="capture-void-legend-layout">Payment Status</legend>
                                                <div class="form-group-amount">
                                                    <label class="col-form-label-payment" for="paymentIdForquery">
                                                        Payment ID</label>
                                                    <input style="color: #061148" type="text" class="form-control"
                                                           placeholder="Payment ID" id="paymentIdForquery"
                                                           width="100px;" />
                                                    <button id="query_payment_btn"
                                                            class="btn btn-primary btn-sm">Payment Status
                                                    </button>
                                                </div>
                                                </fieldset>
                                                <br><br>

                                                <fieldset class="capture-void-layout">
                                                    <legend class="capture-void-legend-layout">Refund</legend>
                                                <div class="refund-layout">

                                                    <div class="form-group-intent-isaggregate">
                                                        <label class="col-form-label-refund" for="paymentIdForRefund">
                                                            Payment ID</label>
                                                        <input style="color: #061148" type="text" class="form-control-merchant-refund-info"
                                                               placeholder="Payment ID" id="paymentIdForRefund"
                                                               width="100px;" />
                                                    </div>

                                                    <div class="form-group-intent-isaggregate">
                                                        <label class="col-form-label-refund" for="transactionIdForRefund">
                                                            Transaction ID</label>

                                                        <input style="color: #061148" type="text" class="form-control-merchant-refund-info"
                                                               placeholder="Transaction ID"
                                                               id="transactionIdForRefund" width="100px;" />
                                                    </div>
                                                    <div class="form-group-intent-isaggregate">
                                                        <label class="col-form-label-refund" for="amountForRefund">
                                                            Refund Amount</label>
                                                        <input style="color: #061148" type="text" class="form-control-merchant-refund-info"
                                                               placeholder="Refund Amount" id="amountForRefund"
                                                               width="100px;" />
                                                    </div>
                                                    <div class="form-group-intent-isaggregate">
                                                        <label class="col-form-label-refund" for="skuForRefund">
                                                            SKU (Name of items for refund)</label>
                                                        <textarea style="color: #061148" type="text" class="form-control-merchant-refund-info"
                                                                  placeholder="Sku" id="skuForRefund"
                                                                  width="100px;"></textarea>
                                                    </div>
                                                    <div class="form-group-intent-isaggregate">
                                                        <label class="col-form-label-refund" for="reasonForRefund">
                                                            Reason For Refund</label>
                                                        <textarea style="color: #061148" type="text" class="form-control-merchant-refund-info"
                                                                  placeholder="Reason" id="reasonForRefund"
                                                                  width="100px;"></textarea>
                                                    </div>

                                                        <button id="requestRefund_btn" class="btn btn-primary btn-sm">Refund
                                                        </button>

                                                </div>
                                                </fieldset>
                                                    <br>
                                                </fieldset>
                                            </div>

                                    </div>

                                    </div>
                                    <div class="col-lg-5">
                                        <div class="bs-component">
                                            <div id="note">
                                                <p >Default values for checkout page:</p>
                                                <div style="display: none">
                                                    <b>Amount :</b>
                                                    <span id="amount"></span>
                                                </div>
                                                <b>Wallet :</b> 01770618575
                                                <br>
                                                <b>OTP :</b> 123456
                                                <br>
                                                <b>PIN :</b> 12121
                                                <br>
                                            </div>
                                            <br />
                                            <br />
                                            <p>API Call</p>
                                            <div id="api_call">

                                            </div>
                                            <br />
                                            <br />
                                            <p>Request</p>
                                            <pre id="request">

                                            </pre>
                                            <br />
                                            <br />
                                            <p>Response</p>
                                            <pre id="response">

                                            </pre>
                                            <br />
                                        </div>
                                    </div>
                                </div>

                                <br/>

                                <h6>Integrate
                                    <b>bKash Checkout</b> in merchant side</h6>
                                ------------------------------------------------
                                <div class="container">
        <pre>
                <code class="language-html">
                    &lt;head>
                    &lt;script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                    crossorigin="anonymous">&lt;/script>
                    &lt;script src="https://scripts.sandbox.bka.sh/versions/1.1.0-beta/checkout/bKash-checkout-sandbox.js">&lt;/script>
                    &lt;/head>
                </code>
            </pre>
                                </div>
                                <br/>
                                <h6>Use
                                    <b>bKash Checkout</b> functions (sample merchant side script)</h6>
                                -----------------------------------------------------------------
                                <div class="container">

        <pre>
            <code class="language-html">
                //Initially keep the button disabled / don't display the button / show some animations
                         &lt;button id="bKash_button" disabled="disabled">Pay With bKash&lt;/button>
            </code>

        </pre>

                                    <pre>

                                    <code class="language-javascript">

            // THE SCRIPT PART

            $.getScript(scriptLink)
            .done(function(script){
                //finished loading the script

            //call the bkash init function
            bKash.init({


                //options -
                //1) 'checkout' : Performs a single checkout.
                paymentMode: 'checkout',

                //paymentRequest format : { amount: _AMOUNT, intent: _INTENT };
                //intent : sale - immediate trx
                //intent : authorization - needs an additional 'Capture' call for trx
                //max two decimal points allowed in amount value.
                //paymentRequest will be ignored for paymentMode 'addWalletOnly'. Just keep it as blank object (paymentRequest:{})
                paymentRequest: { amount: '100.50', intent: 'sale' },

                createRequest: function (request) {


                    //CALL YOUR BACKEND'S CREATE METHOD HERE
                    //IF THE CALL IS SUCCESSFUL, SEND THE CREATE RESPONSE DATA IN bKash.create().onSuccess() METHOD
                        bKash.create().onSuccess(createResponseData);
                    //ELSE, CALL bKash.create().onError() METHOD. bKash will run it's clean up code from there
                        bKash.create().onError();

                },
                executeRequestOnAuthorization: function () {


                    //CALL YOUR BACKEND'S EXECUTE METHOD HERE
                    //IF THE CALL IS SUCCESSFUL, DISPLAY YOUR SUCCESS PAGE
                        window.location.href = "your_success_page.html";
                    //ELSE, CALL bKash.execute().onError() METHOD. bKash will run it's clean up code from there
                        bKash.execute().onError();

                },
                onClose : function () {
                    //define what happens if the user closes the pop up window

                    //your code goes here
                }
            });


            //OPTIONAL function
            //AFTER CALLING bKash.init, you can call bKash.reconfigure method according to your needs

            //    bKash.reconfigure({
            //      paymentMode: 'newPaymentMode',
            //        paymentRequest: 'newPaymentRequest'
            //    });

            // NOTE : VIEW PAGE SOURCE TO SEE REAL LIFE IMPLEMENTATION
            });


</code></pre>
                                    <pre><code class="language-javascript">

                //Enable the button / display the button after bKash init function
                $('#bKash_button').removeAttr('disabled');

            </code>

        </pre>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <footer id="footer">
            <div class="row">
                <div class="col-lg-12">

                    <ul class="list-unstyled">
                        <li class="float-lg-right"><a href="#top">Back to top</a></li>
                    </ul>
                    <p>bKash R&D</p>
                    <p style="font-size: 10px;">Theme made by <a href="http://thomaspark.co">Thomas Park</a>.</p>
                </div>
            </div>

        </footer>


    </div>
</div>


<script type="text/javascript">

    var merchantUrlSet;

    $(document).ready(function () {


        var paymentID;
        var paymentConfig;


        scriptUrlFetch()
            .done(function (url) {
                console.log('Finished Loading Script URL :: ' + url);

                url = url.replace("XXX", $('#version').text());
                console.log('Finished replacing XXX with version number :: Script URL :: ' + url);
                scriptFetch(url)
                    .done(function (script) {
                        console.log('Finished Loading Script :: ' + url);
                        merchantBackendURLFetch()
                            .done(function (merchantBackendObj) {

                                console.log('Finished Loading Merchant Backend URL :: merchantBackendObj :: ');

                                console.log(merchantBackendObj);

                                getApiGWVersion($('#version').text())
                                    .done(function (apiGWVersion) {


                                        $("#apiVersion").text(apiGWVersion);

                                        console.log('Target api version for ' + $('#version').text() + ' is ' + apiGWVersion);
                                        for (var key in merchantBackendObj) {
                                            merchantBackendObj[key] = merchantBackendObj[key].replace("XXX", 'v' + apiGWVersion);
                                        }

                                        console.log('Replacing XXX with proper version number :: merchantBackendObj :: ');
                                        console.log(merchantBackendObj);


                                        paymentConfig = merchantBackendObj;
                                        merchantUrlSet = paymentConfig;
                                        $('#isAggregrator').prop('checked', false);
                                        document.getElementById("merchantAssociationInfo").value = "";
                                        //simulating sample amount value

                                        var randomAmount = (Math.random() * 100).toFixed(2);
                                        $('#amount').text(randomAmount);
                                        $('#new_amount').val(randomAmount);

                                        var paymentRequest;
                                        if ($('input[name=paymentType]:checked').val() == 'immediate') {
                                            paymentRequest = {amount: $('#amount').html(), intent: 'sale'};

                                        } else if ($('input[name=paymentType]:checked').val() == 'authNcapture') {
                                            paymentRequest = {amount: $('#amount').html(), intent: 'authorization'};

                                        }
                                        ;


                                        bKash.init({


                                            //options - 1) 'checkout'
                                            //1) 'checkout' : Performs a single checkout.
                                            paymentMode: 'checkout',
                                            paymentRequest: paymentRequest,


                                            createRequest: function (request) {

                                                console.log('=> createRequest (request) :: ');
                                                console.log(request);

                                                $("#api_call").text('Create Payment');
                                                $('#request').html(JSON.stringify(request, undefined, 2));
                                                alertify.message('Processing ...');


                                                $.ajax({
                                                    url: paymentConfig.createCheckoutURL,
                                                    type: 'POST',
                                                    contentType: 'application/json',
                                                    data: JSON.stringify(request),

                                                    success: function (data) {

                                                        // alert('inside success : create mandate() :; bKash-direct-old.js');
                                                        console.log('got data from create  ..');
                                                        console.log('data ::=>');
                                                        console.log(JSON.stringify(data));
                                                        $('#response').html(JSON.stringify(data, undefined, 2));
                                                        alertify.success("Create Payment response found");
                                                        if (data && data.paymentID != null) {
                                                            paymentID = data.paymentID;
                                                            bKash.create().onSuccess(data);

                                                        } else {
                                                            bKash.create().onError();//run clean up code
                                                            alert(data.errorMessage + " Tag should be 2 digit, Length should be 2 digit, Value should be number of character mention in Length, ex. MI041234 , supported tags are MI, MW, RF");

                                                        }

                                                    },
                                                    error: function () {
                                                        bKash.create().onError();//run clean up code
                                                    }
                                                });


                                            },
                                            executeRequestOnAuthorization: function () {

                                                console.log('=> executeRequestOnAuthorization');
                                                $("#api_call").text('Execute Payment');
                                                $('#request').html(JSON.stringify({"paymentID": paymentID}, undefined, 2));
                                                alertify.message("Processing ...");

                                                $.ajax({
                                                    url: paymentConfig.executeCheckoutURL,
                                                    type: 'POST',
                                                    contentType: 'application/json',
                                                    data: JSON.stringify({"paymentID": paymentID}),

                                                    success: function (data) {

                                                        console.log('got data from execute  ..');
                                                        console.log('data ::=>');
                                                        console.log(JSON.stringify(data));
                                                        $('#response').html(JSON.stringify(data, undefined, 2));
                                                        alertify.success("Execute Payment response found");


                                                        if (data && data.paymentID != null) {
;
                                                                bKash.execute().onError();//run clean up code

                                                        }else {
                                                            alertify.error('Unsuccessful Checkout Payment');

                                                            bKash.execute().onError();//run clean up code

                                                        }

                                                    },
                                                    error: function () {
                                                        alert('An alert has occured during execute');

                                                        bKash.execute().onError();//run clean up code

                                                    }
                                                });
                                            },

                                            onClose: function () {
                                                alert('User has clicked the close button');
                                            }
                                        });


                                        $('#bKash_button').removeAttr('disabled');


                                        $('input[type=radio][name=paymentType]').change(function () {
                                            var merchantAssociationInfo;
                                            if (this.value == 'immediate') {
                                                if ($("#isAggregrator").is(":checked")) {
                                                    merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value;
                                                    merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                                                    if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                                                        bKash.reconfigure({
                                                            paymentRequest: {
                                                                amount: $('#amount').html(),
                                                                intent: 'sale',
                                                                merchantAssociationInfo: merchantAssociationInfo
                                                            }
                                                        });
                                                    } else {
                                                        bKash.reconfigure({
                                                            paymentRequest: {
                                                                amount: $('#amount').html(),
                                                                intent: 'sale'
                                                            }
                                                        });
                                                    }
                                                } else {
                                                    bKash.reconfigure({
                                                        paymentRequest: {amount: $('#amount').html(), intent: 'sale'}
                                                    });

                                                }

                                            } else if (this.value == 'authNcapture') {

                                                if ($("#isAggregrator").is(":checked")) {


                                                    merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value
                                                    merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                                                    if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                                                        bKash.reconfigure({
                                                            paymentRequest: {
                                                                amount: $('#amount').html(),
                                                                intent: 'authorization',
                                                                merchantAssociationInfo: merchantAssociationInfo
                                                            }
                                                        });
                                                    } else {
                                                        bKash.reconfigure({
                                                            paymentRequest: {
                                                                amount: $('#amount').html(),
                                                                intent: 'authorization'
                                                            }
                                                        });
                                                    }

                                                } else {
                                                    bKash.reconfigure({
                                                        paymentRequest: {
                                                            amount: $('#amount').html(),
                                                            intent: 'authorization'
                                                        }
                                                    });

                                                }
                                            }
                                        });

                                    })

                                    .fail(function (error) {
                                        alert("Error while fetching dropdown - apiGW Version mapping");

                                    })

                            })
                            .fail(function (error) {
                                alert("Error while fetching merchant backend URL");

                            })
                    })
                    .fail(function (error) {
                        alert("Error while fetching script");

                    })
            })
            .fail(function (error) {
                alert("Error while fetching script URL");
            })
    });


    $("#change_amount").click(function () {
        console.log('Change Amount Clicked');
        var amountRegex = /^\d+(\.\d{2})?$/;
        var new_amount = $("#new_amount").val();
        new_amount = new_amount.replace(/</g, "&lt;").replace(/>/g, "&gt;");

        if (amountRegex.test(new_amount)) {
            $('#amount').text(new_amount);

            var merchantAssociationInfo;

            if ($('input[name=paymentType]:checked').val() == 'immediate') {

                if ($("#isAggregrator").is(":checked")) {
                    merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value;
                    merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                        bKash.reconfigure({
                            paymentRequest: {
                                amount: $('#amount').html(),
                                intent: 'sale',
                                merchantAssociationInfo: merchantAssociationInfo
                            }
                        });
                    } else {
                        bKash.reconfigure({
                            paymentRequest: {amount: $('#amount').html(), intent: 'sale'}
                        });
                    }
                } else {
                    bKash.reconfigure({
                        paymentRequest: {amount: $('#amount').html(), intent: 'sale'}
                    });

                }
            } else if ($('input[name=paymentType]:checked').val() == 'authNcapture') {

                if ($("#isAggregrator").is(":checked")) {

                    merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value;
                    merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                        bKash.reconfigure({
                            paymentRequest: {
                                amount: $('#amount').html(),
                                intent: 'authorization',
                                merchantAssociationInfo: merchantAssociationInfo
                            }
                        });
                    } else {
                        bKash.reconfigure({
                            paymentRequest: {amount: $('#amount').html(), intent: 'authorization'}
                        });
                    }
                } else {
                    bKash.reconfigure({
                        paymentRequest: {amount: $('#amount').html(), intent: 'authorization'}
                    });
                }

            }
        } else {
            alert('Invalid Amount');
        }
    });

    $(function () {
        $("#isAggregrator").click(function () {
            if ($(this).is(":checked")) {
                $("#dvAggregratorInfo").show();
            } else {
                document.getElementById("merchantAssociationInfo").value = "";
                $("#dvAggregratorInfo").hide();
            }
        });
    });

    function getAggretaroInfo() {
        var merchantAssociationInfo;
        if ($('input[type=radio][name=paymentType]').val() == 'immediate') {
            if ($("#isAggregrator").is(":checked")) {
                merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value;
                merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                    bKash.reconfigure({
                        paymentRequest: {
                            amount: $('#amount').html(),
                            intent: 'sale',
                            merchantAssociationInfo: merchantAssociationInfo
                        }
                    });
                } else {
                    bKash.reconfigure({
                        paymentRequest: {amount: $('#amount').html(), intent: 'sale'}
                    });
                }

            } else if (this.value == 'authNcapture') {
                merchantAssociationInfo = document.getElementById("merchantAssociationInfo").value
                merchantAssociationInfo = merchantAssociationInfo.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                if (merchantAssociationInfo != null || !merchantAssociationInfo.isEmptyObject()) {
                    bKash.reconfigure({
                        paymentRequest: {
                            amount: $('#amount').html(),
                            intent: 'authorization',
                            merchantAssociationInfo: merchantAssociationInfo
                        }
                    });
                } else {
                    bKash.reconfigure({
                        paymentRequest: {amount: $('#amount').html(), intent: 'authorization'}
                    });
                }
            }

        }
    }

    $('#searchTransaction_btn').click(function () {
        var transactionID = document.getElementById('searchTransaction').value;
        transactionID = transactionID.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        console.log('Search Transaction response:: transactionID' + transactionID + " Search Transaction URL: "+ merchantUrlSet.checkoutSearchTransactionURL);
        searchTransactionResponse(transactionID, merchantUrlSet.checkoutSearchTransactionURL)
            .done(function (response) {
                console.log('Search Transaction response:: ' + JSON.stringify(response));
                $('#response').html(JSON.stringify(response, undefined, 2));

                alertify.success('Search transaction response found');
            })
            .fail(function (error) {
                console.log('Search Transaction error:: ');
                console.log(error);
                alertify.error('Failed Search Transaction');
            });

    });
    $('#requestRefund_btn').click(function () {
        var transactionID = document.getElementById('transactionIdForRefund').value;
        transactionID = transactionID.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        var paymentID = document.getElementById('paymentIdForRefund').value;
        paymentID = paymentID.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        var amount = document.getElementById('amountForRefund').value;
        amount = amount.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        var sku = document.getElementById('skuForRefund').value;
        sku = sku.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        var reason = document.getElementById('reasonForRefund').value;
        reason = reason.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        console.log('Refund response:: transactionID' + transactionID + " Refund URL: "+ merchantUrlSet.checkoutRefundURL);
        refundResponse(transactionID,paymentID,amount,sku,reason, merchantUrlSet.checkoutRefundURL)
            .done(function (response) {
                console.log('Refund response:: ' + JSON.stringify(response));
                $('#response').html(JSON.stringify(response, undefined, 2));

                alertify.success('Refund response found');
            })
            .fail(function (error) {
                console.log('Refund error:: ');
                console.log(error);
                alertify.error('Failed Refund');
            });

    });

    $('#query_payment_btn').click(function () {
        var paymentId = document.getElementById('paymentIdForquery').value;
        paymentId = paymentId.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        console.log('queryPayment response:: paymentId' + paymentId);
        paymentStatusResponse(paymentId, merchantUrlSet.checkoutPaymentStatusURL)
            .done(function (response) {
                console.log('PaymentStatus response:: ' + JSON.stringify(response));
                $('#response').html(JSON.stringify(response, undefined, 2));

                alertify.success('Payment status response found');
            })
            .fail(function (error) {
                console.log('PaymentStatus error:: ');
                console.log(error);
                alertify.error('Failed Payment Status');
            });

    });

    function paymentStatusResponse(paymentID, url) {
        console.log(url);


        $("#api_call").text('Query Payment Status');
        $('#request').html(JSON.stringify({ "paymentID": paymentID }, undefined, 2));
        alertify.message("Processing ...");

        return $.ajax({
            url: url,
            type: 'POST',
            data: JSON.stringify({ "paymentID": paymentID }),
            contentType: 'application/json'
        });
    }

    function searchTransactionResponse(transactionID, url) {
        console.log(url);
        $("#api_call").text('Search Transaction');
        $('#request').html(JSON.stringify({ "trxID": transactionID }, undefined, 2));
        alertify.message("Processing ...");

        return $.ajax({
            url: url+transactionID,
            type: 'GET'
        });
    }
    function refundResponse(transactionID, paymentID, amount, sku, reason, url) {
        console.log(transactionID, paymentID, amount, sku, reason, url);
        $("#api_call").text('Search Transaction');
        $('#request').html(JSON.stringify({
            "paymentID":paymentID,
            "amount":amount,
            "trxID":transactionID,
            "sku" : sku,
            "reason" : reason
        }, undefined, 2));
        alertify.message("Processing ...");

        return $.ajax({
            url: url,
            type: 'POST',
            data: JSON.stringify({
                "paymentID":paymentID,
                "amount":amount,
                "trxID":transactionID,
                "sku" : sku,
                "reason" : reason
            }),
            contentType: 'application/json'
        });
    }

</script>
</body>
</html>
